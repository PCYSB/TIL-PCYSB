06-2 메모리의 주소 공간

# 물리 주소와 논리 주소 
CPU와 실행 중인 프로그램은 현재 메모리 몇 번지에 무엇이 저장되어 있는지 다 알고 있을까? 그렇지 않다. 왜냐하면 그 이유는 아래와 같다.
- 메모리에 저장된 정보는 시시각각 변한다.
- 메모리에는 새롭게 실행되는 프로그램이 시시때때로 적재된다.
- 실행이 끝난 프로그램은 삭제된다.
- 같은 프로그램을 실행하더라도 실행할 때마다 적재되는 주소가 달라질 수 있다.
그렇다면 CPU와 실행 중인 프로그램이 이해하는 주소는 무엇일까?

## 물리 주소
pysical address
말 그대로 실제로 저장된 하드웨어상의 주소를 의미한다.
그 전에 우리는 메모리가 저장장치에 불과하다는 것을 잊으면 안 된다. 메모리 자체는 굉~~장히 큰 배열로 생각하여도 무방하다. 그리고 배열이기에 인덱스 값을 가지는데, 이 인덱스 값을 '물리적 주소'라고 한다. 즉 물리적 주소는 메모리 자체의 인덱스이다.


## 논리 주소
logical address
실행 중인 프로그램 각각에게 부여된 0번지부터 시작되는 주소를 의미한다.
왜냐하면 메모리에 여러 실행 중인 프로그램이 있을 수 있지만 이 프로그램들은 언제든 메모리에서 사라질 수 있기 때문에 물리 주소가 무엇인지 굳이 알 필요가 없다.
그래서 여러 프로그램들은 물리 주소가 아닌 0번지부터 시작하는 자신만을 위한 주소인 논리 주소를 가지고 있다.


## 논리 주소의 물리 주소 변환
논리 주소는 CPU와 실행 중인 프로그램이 사용하는 주소이다. 그렇지만 CPU가 이해하는 주소가 논리 주소라고는 해도 CPU가 메모리와 상호작용하려면 논리 주소와 물리 주소 간의 변환이 이루어져야 한다.
논리 주소와 물리 주소 간의 변환은 CPU와 주소 버스 사이에 위치한 **메모리 관리 장치** MMU(Memory Management Unit)라는 하드웨어에 의해 수행된다.
MMU는 CPU가 발생시킨 논리 주소에 베이스 레지스터 값을 더하여 논리 주소를 물리 주소로 변환 한다. 예를 들어 베이스 레지스터에 15000이 저장되어 있고 CPU가 발생시킨 논리 주소가 100번지라면 이 논리 주소는 물리 주소 15100번지로 변환된다. **물리 주소 15000번지부터 적재된 프로그램 A의 논리 주소 100번지에는 이렇게 접근을 하는 것이다.**

베이스 레지스터는 프로그램의 가장 작은 물리 주소, 즉 프로그램의 첫 물리 주소를 저장하는 셈이고
논리 주소는 프로그램의 시작점으로부터 떨어진 거리인 셈이다.

# 메모리 보호 기법
메모장, 인터넷 브라우저 프로그램, 게임 3가지의 프로그램이 돌아가고 있다고 가정해보자.
메모장은 1000~1999번지, 인터넷 브라우저 프로그램은 2000~2999번지, 게임은 3000~3999번지의 물리 주소에 할당되어 있다고 가정을 할 때
만약 CPU가 메모장의 1500번지에 숫자 100을 저장 하라고 한다면?
베이스 레지스터에서 메모장의 시작 주소 번지는 1000번지이다. 그렇다면 CPU는 첫 물리 주소 기준인 1000번지 + 1500번지인 2500번지에 100을 저장할 것이다. 그렇다면? 2500번지인 인터넷 브라우저 프로그램에 2500 번지에 저장을 할 텐데 이 명령어는 실행되어도 안전한 것인가?

이렇게 다른 프로그램의 영역을 침범할 수 있는 명령어는 위험하기에 논리 주소 범위를 벗어나는 명령어 실행을 방지하고 실행 중인 프로그램이 다른 프로그램에 영향을 받지 않도록 보호할 방법이 필요하다.
이러한 일은 **한계 레지스터**라는 레지스터가 담당한다.

### 한계 레지스터
- 한게 레지스터는 논리 주소의 최대 크기를 저장한다.
- 즉 프로그램의 물리 주소 범위는 베이스 레지스터 값 <= 한계 레지스터 값 <= 베이스 레지스터 값 + 한계 레지스터 값
CPU가 접근하려는 논리 주소는 한계 레지스터가 저장한 값보다 커서는 안 된다.
때문에 CPU는 메모리에 접근하기 전에 접근하고자 하는 논리 주소가 한계 레지스터보다 작은지를 항상 검사한다. 만약 CPU가 한계 레지스터보다 높은 논리 주소에 접근하려고 하면 인터럽트를 발생시켜 실행을 중단한다.