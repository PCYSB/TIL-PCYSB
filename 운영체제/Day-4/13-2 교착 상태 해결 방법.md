13-2 교착 상태 해결 방법

# 교착 상태 에방
교착 상태를 예방하는 방법은 교착 상태의 조건 4가지 중 하나를 충족하지 못하게 하는 것이다.
- 상호 배제, 점유 및 대기, 자원 할당 그래프가 원의 형태, 비선점

## 자원의 상호 배제를 없앳을 경우
상호 배제를 없앤다는 말은 모든 자원을 공유 가능하게 만든다는 말과 같다.
- 이론적으로 교착 상태를 없앨 수 있다.
- 동기화 개념에서 나왔듯이 현실적으로 모든 자원의 상호 배제를 없애기는 어렵다.(문제가 발생할 수 있음)

> 상호 배제 자체가 해당 자원을 동시에 사용하였을 때 발생하는 문제를 배제하기 위함이므로 이는 조금 곤란할 것 같다. 예시로 프린터와 같은 자원의 경우 여러개의 프로세서가 요청하는 것을 동시에 뽑아 줄수 있을까?

![alt text](<스크린샷 2024-04-12 204328.png>)

## 점유와 대기를 없앳을 경우
점유와 대기를 없애는 경우는 식사하는 철학자 문제에서 철학자가 한 손에 포크를 들고 대기하지 못하도록 하는 것과 같다.
- 철학자 문제의 경우만 보았을때 아주 좋아 보이지만 자원의 활용률이 낮아질 우려가 있다.
- 한 프로세스에 필요한 자원을 몰아주고, 그 다음에 다른 프로세스에 필요한 자원들을 몰아줘야한다.
- 이 때문에 당장 자원이 필요해도 기다릴 수밖에 없는 프로세스와 사용되지 않으면서 오랫동안 할당되는 자원을 다수 양산하기 때문에 자원의 활용률이 낮아진다.
- 추가로 이는 많은 자원을 사용하는 프로세스가 불리해짐

## 비선점 조건을 없앳을 경우
비선점 조건을 없앤다는 것은 식사하는 철학자 문제에서 다른 포크를 들고 대기하고 있는 철학자의 포크를 빼앗아 오는 것과 같다.
- 이는 일부 자원에 대해서는 효과적이다. CPU는 프로세스들이 선점할 수 있는 대표적인 자원이기도 하고
- 모든 자원이 선점가능한 것은 아니다.

> 프린터 같은 경우에도 도중에 다른 프로세스에서 빼앗아 사용한다면 사용자가 원치 않는 결과물이 발생할 것이다.

## 원형 대기 조건을 없앳을 경우
원형 대기를 없애는 방법은 모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당하면 된다.
- 모든 컴퓨터 시스템 내에 존재하는 수많은 자원에 번호를 붙이는 일은 간단한 작업이 아니다. 각 자원에 어떤 번호를 붙이는지에 따라 특정 자원의 활용률이 떨어질 수 있다.
- 예방 방식은 교착 상태가 발생하지 않음을 보장할 수는 있지만 여러 부작용이 따른다.
![alt text](<스크린샷 2024-04-12 204356.png>)

![alt text](<스크린샷 2024-04-12 204404.png>)

# 교착 상태 회피
교착 상태 회피에서는 교착상태를 **한정된 자원의 무분별한 할당으로 인해 발생하는 문제로 간주한다.**
- 자원이 충분한 상황에서 프로세스들이 한두 개의 적은 자원만을 요구한다면 교착 상태는 발생하지 않는다.
- 프로세스들에 할당할 수 있는자원이 한정된 상황에서 모든 프로세스들이 한 번에 많은 자원을 요구하면 교착 상태가 발생할 위험이 증가한다.
    - 이렇게 **교착 상태가 발생하지 않을 정도의 양만큼만 자원을 배분하는 방법이 교착 상태 회피**이다.
    - 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태를 **안전 상태**라고 부르며, 교착 상태가 발생할 수도 있는 상황을 **불완전 상태**라고 부른다.
    - 여기서 **안전 순서열**이라는 개념이 있는데 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서를 의미한다. 쉽게 생각하여 안전 순서열이 있다면 안전 상태 없다면 불안전 상태라고 한다.

> 안전 순서열은 밑에 예제를 보는 것이 이해가 더 빠를것이다. 안전 순서열의 경우 프로세스들에게 적은 자원을(감당 가능한 정도로)할당해주고 순서대로 해결할 수 있을 정도의 상태를 말한다고 생각된다.

해당 상태는 안전 상태이다. P1, P2, P3이 모두 최대로 자원을 요구한 최악의 상황에서도  P2 -> P1 -> P3의 순서대로 프로세스에게 자원을 할당해줄 수 있기 때문이다.
![alt text](<스크린샷 2024-04-12 220316.png>)
![alt text](<스크린샷 2024-04-12 220323.png>)
![alt text](<스크린샷 2024-04-12 220340.png>)

해당 상태는 불안전 상태이다. P1, P2, P3이 모두 최대로 자원을 요구한 최악의 상황에서 교착 상태가 발생하기 때문이다.
![alt text](<스크린샷 2024-04-12 220414.png>)
![alt text](<스크린샷 2024-04-12 220430.png>)

교착 상태의 회피 방식은 항시 안전 상태를 유지하도록 자원을 할당하는 방식이다.

# 교착 상태 검출 후 회복
교착상태 예방과 회피가 교착 상태 발생을 막기위한 노력이였다면, 교착 상태 검출 후 회복은 교착 상태 발생을 인정하고 수후에 조치하는 방식이다.
- 해당 방식에서 운영체제는 프로세스들이 자원을 요구할 때마다 그때그때 모두 할당하며, 교착 상태 발생 여부를 주기적으로 검사한다.
- 교착 상태가 검출되면 그때 회복하는 방식이다.
- 내가 이해한 바로는 교착 상태 검출 후 회복에서는 교착 상태 발생을 막기위한 노력이 없다.
- 회복 방식은 아래와 같다.

## 선점을 통한 회복
교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식이다. 교착 상태가 핼결될 때까지 다른 프로세스로부터 자원을 빼앗고 한 프로세스에 할당하는 방식이다.

## 프로세스 강제 종료를 통한 회복
가장 단순하면서 확실한 방식이다.
- 운영체제는 교착 상태에 놓인 프로세스를 모두 강제 종료할 수도 있다.
  - 한 방에 교착 상태를 해결할 수 있는 가장 확실한 방식이지만 그만큼 많은 프로세스들이 작업 내역을 잃게 될 가능성이 있다.
- 아니면 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료할 수도 있다.
  - 작업 내역을 잃는 프로세스는 최대한 줄일수 있지만 교착 상태가 없어졌는지 여부를 확인하는 과정에서 오버헤드를 야기한다.

# 정리
- 교착 상태 해결 방법에는 예방, 회피, 검출 후 회복이 있다.
- 교착 상태의 회피 방식은 항시 안전 상태를 유지하도록 자원을 할당하는 방식이다.