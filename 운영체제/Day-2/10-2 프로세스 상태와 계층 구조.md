10-2 프로세스 상태와 계층 구조

# 프로세스 상태
운영체제마다 조금식 차이가 있지만, 프로세스가 가질 수 있는 대표적인 상태는 5가지가 있다.
생성, 준비, 실행, 대기, 종료 상태

이런 도표를 **프로세스 상태 다이어그램**이라고 한다.
![alt text](<스크린샷 2024-03-24 191121.png>)

> - 컴퓨터 내의 여러 프로세스는 생성, 준비, 실행, 대기, 종료 상태를 거치며 실행된다.
> - 운영체제는 이 상태를 PCB에 기록하며 프로세스들을 관리한다.

## 생성 상태
프로세스를 생성 중인 상태를 말한다.

> - 이제 막 메모리에 적재되어 PCB를 할당 받은 상태
> - 생성 상태를 거쳐 실행할 준비가 완료된 프로세스는 곧바로 실행되지 않고 준비 상태가 되어 CPU의 할당을 기다린다.

## 준비 상태
당장이라도 CPU를 할당받아 실행할 수 있지만, 아직 자신의 차례가 아니기에 기다리고 있는 상태.
언제든지 실행할 수 있는 상태일 뿐이다.

> - 준비 상태 프로세스는 차례가 되면 CPU를 할당받아 실행 상태가 된다.

## 실행 상태
CPU를 할당받아 실행 중인 상태를 의미한다.

> - 프로세스가 할당된 시간을 모두 사용한다면 다시 준비 상태가 되고, 실행 도중 입출력장치를 사용하여 입출력 장치의 작업이 끝날 때까지 가다려야 한다면 대기 상태가 된다.

## 대기 상태
입출력장치의 작업을 기다리는 상태

> - 입출력 작업을 요청한 프로세스는 입출력장치가 입출력을 끝낼 때까지 기다려야한다.
> - 입출력 작업이 완료되면 해당 프로세스는 다시 준비 상태로 CPU할당을 기다린다.
> - 입출력장치의 작업을 기다린다고 하였는데 일반적으로 표현하자면 특정 이벤트가 일어나길 기다릴 때 프로세스는 대기 상태가 된다. 그런데 대부분의 대기 상태가 일어나는 이유가 입출력 작업이기 때문에 입출력 작업을 하면 대기 상태가 된다고 생각해도 무방하다.

## 종료 상태
프로세스가 종료된 상태이다.

> - 프로세스가 종료되면 운영체제는 PCB와 프로세스가 사용한 메모리를 정리한다.

# 프로세스 계층 구조
- 프로세스는 실행 도중 시스템 호출을 통해 다른 프로세스를 생성할 수 있다.
- 새 프로세스를 생성한 프로세스를 **부모 프로세스**
- **부모 프로세스**에 의해 생성된 프로세스를 **자식 프로세스**라고 한다.

> - 부모, 자식 프로세스는 엄연히 다른 프로세스이다.
> - 그렇기에 각기 다른 PID를 가진다.
> - 일부 운영체제에서는 자식 프로세스의 PCB에 부모 프로세스의 PID인 PPID가 기록되기도 한다.
> - 자식 프로세서도 자식 프로세스를 갖는것이 가능하다.
> - 이와 같이 많은 운영체제에서는 프로세스가 프로세스를 낳는 계층적인 구조로써 프로세스들을 관리한다.

### 프로세스 계층 구조
![alt text](<스크린샷 2024-03-24 191759.png>)

밑의 그림을 보자
1) 사용자가 컴퓨터를 켠 순간에 생성된 최초 프로세스는 로그인을 담당하는 프로세스를 자식 프로세스로 생성
2) 로그인 프로세스는 사용자 인터페이스(bash 셸) 프로세스를 자식 프로세스로 생성
3) 사용자 인터페이스 프로세스는 Vim 프로세서를 생성한 셈이다.

![alt text](<스크린샷 2024-03-24 191829.png>)

# 프로세스 생성 기법
- 부모 프로세스는 **fork**를 통해 자신의 복사본을 자식 프로새스로 생성
- 자식 프로세스는 **exec**를 통해 자신의 메모리 공간을 다른 프로그램으로 교체한다.
- 이를 **복제와 옷 갈아입기**라고 한다.
  
  > - fork와 exec는 시스템 호출이다.
  > - fork는 자기 자신 프로세스의 복사본을 만드는 시스템 호출
  > - 자식 프로세스는 부모 프로세스의 복사본이기 때문에 부모 프로세스의 자원들, 메모리내의 내용, 열린 파일의 목록등이 상속된다.
  > - 복사되었다고 하지만 둘 은 엄연히 다른 프로세스이기에 PID값이나 저장된 메모리 위치는 다르다.
  > - fork를 통해 복사본이 만들어진 자식 프로세스는 exec 시스템 호출을 통해 새로운 프로그램으로 전환된다.
  > - 메모리 공간을 새로운 프로그램으로 덮어쓰는 시스템 호출이다.

  # 정리 
  - 프로세스 상태는 생성, 준비, 실행, 대기, 종료 크게 5가지가 있다.
  - 계층 구조는 복제와 옷 갈아입기 fork와 exec로 이루어진다.