12-1 동기화란

# 동기화의 의미
- 사전적 정의로는 작업들 사이의 수행 시기를 맞추는 것
- 쉽게 말해 프로세스들 사이의 수행 시기를 맞추는 것을 의미한다.

> - 수행 시기를 맞춘다는 것은 동시에 실행된다는 소리가 아니고 수행 시기의 순서를 맞춘다 라고 생각하면 될 것 같다.
> - 즉 협력적으로 실행되는 프로세스들은 아무렇게나 마구 동시에 실행해서는 안된다는 말이기도 하다.
> - 프로세스 뿐만 아니라 스레드도 동기화 대상이다. 실행의 흐름을 갖는 모든 것은 동기화의 대상이다.
그렇다면 수행 시기를 맞추는 것은 무엇을 의미하는지는 크게 아래 두 가지를 일컫는다.

## 실행 순서 제어
- 동시에 실행되는 프로세스를 **올바른 순서대로 실행**하는 것이 첫 번째 프로세스 동기화이다.

> - 예를 들어 쓰기를 담당하는 **Write** 프로세스와 읽기를 담당하는 **Reader** 프로세스가 Book.txt 파일이 있다고 가정하였을 때
> - Reader 프로세스는 Write 프로세스 실행이 끝나야 비로소 실행될 수 있다. 이는 Book.txt 안에 값이 존재한다는 특정 조건이 만족되어야만 실행을 이어 나갈수 있기 때문이다.

## 상호 배제
- **공유가 불가능한 자원의 동시 사용을 피하기** 위해 사용하는 알고리즘이다.

> - 계좌에 10만원이 저축 되어있고, 프로세스 A는 저축된 금액에 2만원, 프로세스 B는 5만원을 넣는 프로세스라고 가정해보자.
> - 프로세스 A와 B가 동시에 실행되었다고 가정해 볼시 아래와 같은 결과가 나올 수 있다.
![alt text](<스크린샷 2024-04-01 203603.png>)
A와 B는 잔액이라는 데이터를 동시에 사용하는데, A가 끝나기도 전에 B가 잔액을 읽어 버렸기 때문에 이러한 결과가 나온 것이다.
때문에 A와 B를 올바르게 실행되기 위해서는 한 프로세스가 잔액에 접근했을 때 다른 프로세스는 기다려야 한다.
![alt text](<스크린샷 2024-04-01 203754.png>)

이렇게 동시에 접근해서는 안 되는 자원에 동시에 접근하지 못하게 하는 것이 **상호 배제를 위한 동기화**이다.

# 생산자와 소비자 문제
상호 배제를 위한 동기화에 대한 예제이다.

1. 생산자와 소비자는 총합이라는 데이터를 공유하고 있다. 
2. 생산자는 버퍼에 물건을 넣은 후, 물건의 총합에 해당하는 변수를 1 증가
3. 소비자는 버퍼에 물건을 빼낸 후 물건에 총합에 해당하는 변수를 1 감소

![alt text](<스크린샷 2024-04-01 204026.png>)

위와 같은 상태에서 생산자를 100,000번, 소비자를 100,000번 동시에 실행한다면 실행 결과 총합은 몇이 될 것인가?
막상 동시에 실행해본다면 10이 아닌 수가 되거나 실행 중 오류가 나기도 한다.
생산자, 소비자 프로세스가 제대로 동기화되지 않았기 때문에 발생한 문제이다.
그전의 예제에서 보았듯이 생산자가 소비자의 작업이 끝나기도 전에 총합을 수정했기 때문에 엉뚱한 결과가 발생한 것이다.
즉 동시에 접근해서는 안 되는 자원에 동시에 접근했기에 발생한 문제이다.

# 공유 자원과 임계 구역

## 공유 자원
여러 프로세스, 스레드가 공유하는 자원
- 전역 변수, 파일, 입출력장치, 보조기억장치가 될 수도 있다.

## 임계 구역
공유 자원의 경우 두 개 이상의 프로세스를 동시에 실행하면 문제가 발생하는 자원이 있다. 
이때 **동시에 실행하면 문제가 발생하는 자원에 접근하는 코드영역을 임계 구역이라고 한다.**
두 개 이상의 프로세스가 임계 구역에 진입하고자 하면 둘 중 하나는 대기해야 한다.
![alt text](<스크린샷 2024-04-01 210122.png>)

임계 구역은 두 개 이상의 프로세스가 동시에 실행되면 안 되는 영역이지만, 잘못된 실행으로 인해 여러 프로세스가 동시 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우를 **레이스 컨디션**이라고 한다.(계좌 잔액 문제와 생산자 소비자 문제와 같은 사례)

### 레이스 컨디션
레이스 컨디션이 발생하는 근본적인 이유는 무엇일까?
알다싶이 고급 언어는 저급 언어로 변환되어 실행 된다. 컴퓨터는 저급언어를 실행하고, 때문에 여러 줄의 저급 언어로 변환된 고급 언어 한 줄을 실행하는 과정에서 문맥 교환이 일어날 수 있다. 그런 문맥 교환이 일어날 시 아래와 같은 문제가 발생한다.
![alt text](<스크린샷 2024-04-01 210430.png>)

상호 배제를 위한 동기화는 이와 같은 일이 발생하지 않도록 두 개 이상의 프로세스가 임계 구역에 동시에 접근하지 못하도록 관리하는 것을 의미한다. 운영 체제는 이러한 임계 구역 문제를 세 가지 원칙 하에 해결한다.

- 상호배제: 한 프로세스가 임계구역에 진입시 다른 프로세스는 임계구역에 들어올 수 없다.
- 진행: 임계구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
- 유한 대기: 임계 구역에 프로세스가 진입하고 싶다면 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 한다.